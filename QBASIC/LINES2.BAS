DECLARE SUB TestTX ()
DECLARE FUNCTION n$ (n%)
DECLARE FUNCTION nd$ (A#)
DECLARE SUB TX (s AS STRING)

CALL TestTX
OPEN "LPT3" FOR OUTPUT AS #1
TX("M10CU1,0CO8KB1,0CL0")
TX("CL0CO0B0,0,640,480CO7")

DEFINT A-Z:RANDOMIZE TIMER
DIM SX(100),SY(100),EX(100),EY(100):IL=32
P=0:L=IL:D=1:C=INT(RND*15)+1
FOR I=0 TO IL
  SX(I)=0:SY(I)=0:EX(I)=0:EY(I)=0
NEXT I
SX(0)=INT(RND*320):SY(0)=INT(RND*240)
EX(0)=INT(RND*320)+320:EY(0)=INT(RND*240)+240
SX(IL)=SX(0):SY(IL)=SY(0):EX(IL)=EX(0):EY(IL)=EY(0)
MSX=1:MSY=1:MEX=1:MEY=1:T0#=TIMER
WHILE LEN(INKEY$)=0
  TX("CO0L"+n$(SX(D))+","+n$(SY(D))+","+n$(EX(D))+","+n$(EY(D)))
  TX("CO"+n$(C)+"L"+n$(SX(P))+","+n$(SY(P))+","+n$(EX(P))+","+n$(EY(P)))
  P=P+1:IF P>IL THEN P=0
  D=D+1:IF D>IL THEN D=0
  L=L+1:IF L>IL THEN L=0
  C=C+1:IF C>255-8 THEN C=1
  SX(P)=SX(L)+MSX:IF SX(P)<0 THEN SX(P)=-SX(P):MSX=-MSX ELSE IF SX(P)>639 THEN SX(P)=639*2-SX(P):MSX=-MSX
  SY(P)=SY(L)+MSY:IF SY(P)<0 THEN SY(P)=-SY(P):MSY=-MSY ELSE IF SY(P)>479 THEN SY(P)=479*2-SY(P):MSY=-MSY
  EX(P)=EX(L)+MEX:IF EX(P)<0 THEN EX(P)=-EX(P):MEX=-MEX ELSE IF EX(P)>639 THEN EX(P)=639*2-EX(P):MEX=-MEX
  EY(P)=EY(L)+MEY:IF EY(P)<0 THEN EY(P)=-EY(P):MEY=-MEY ELSE IF EY(P)>479 THEN EY(P)=479*2-EY(P):MEY=-MEY
  MSX=MSX+INT(RND*5)-2:IF MSX<-5 THEN MSX=-5 ELSE IF MSX>5 THEN MSX=5
  MSY=MSY+INT(RND*5)-2:IF MSY<-5 THEN MSY=-5 ELSE IF MSY>5 THEN MSY=5
  MEX=MEX+INT(RND*5)-2:IF MEX<-5 THEN MEX=-5 ELSE IF MEX>5 THEN MEX=5
  MEY=MEY+INT(RND*5)-2:IF MEY<-5 THEN MEY=-5 ELSE IF MEY>5 THEN MEY=5
  DO:T#=TIMER:LOOP WHILE (T#-T0#)<0.016:T0#=T#
WEND

TX("KB1,1M3CU1,1")
CLOSE
CLS:END

DATA &H50,&H53,&H56,&HBE,&H00,&H00,&H2E,&HC7,&H04,&H00,&H00,&HB8,&H00,&HDB,&HCD,&H2F
DATA &H3C,&HFF,&H75,&H12,&H81,&HFB,&H50,&H54,&H75,&H0C,&HB8,&H11,&H00,&HCD,&H79,&H75
DATA &H05,&h2E,&HC7,&H04,&H01,&H00,&H5E,&H5B,&H58,&HCB

SUB TestTX
  DIM A%(50)
  DEF SEG = VARSEG(A%(0))
  RESTORE
  FOR I% = 0 TO 41
    READ D%
    IF I% = 4 THEN
       D% = VARPTR(A%(49)) MOD 256
    ELSEIF I% = 5 THEN
       D% = VARPTR(A%(49)) / 256
    END IF
    POKE VARPTR(A%(0)) + I%, D%
  NEXT I%
  CALL ABSOLUTE(VARPTR(A%(0)))
  DEF SEG
  IF A%(49) = 0 THEN
    PRINT "Please run TX.COM first"
    END
  END IF
END SUB

FUNCTION n$ (A AS INTEGER)
n$ = LTRIM$(RTRIM$(STR$(A)))
END FUNCTION

FUNCTION nd$ (A AS DOUBLE)
nd$ = LTRIM$(RTRIM$(STR$(A)))
END FUNCTION

SUB TX (s AS STRING)
PRINT #1, CHR$(14); "["; s; "]";
END SUB

