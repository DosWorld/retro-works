DEFINT A-Z
TYPE PoemT
  TITLE AS STRING*60
  AUTHOR AS STRING*30
END TYPE
TYPE ContentT
  ID AS INTEGER
  OPER AS INTEGER
  TEXT AS STRING*100
END TYPE
COMMON SHARED TITLELEN,CONTENTLEN
DECLARE SUB TestTX ()
DECLARE FUNCTION n$ (n%)
DECLARE SUB TX (s AS STRING)
DECLARE SUB DrawText(x as integer,y as integer,text as string)
DATA &H50,&H53,&H56,&HBE,&H00,&H00,&H2E,&HC7,&H04,&H00,&H00,&HB8,&H00,&HDB,&HCD,&H2F
DATA &H3C,&HFF,&H75,&H12,&H81,&HFB,&H50,&H54,&H75,&H0C,&HB8,&H11,&H00,&HCD,&H79,&H75
DATA &H05,&h2E,&HC7,&H04,&H01,&H00,&H5E,&H5B,&H58,&HCB

InitTX

TITLELEN=0
CONTENTLEN=0
DIM SHARED TITLELIST(32) AS PoemT
DIM SHARED CONTENTLIST(600) AS ContentT

PRINT "º”‘ÿ÷–°≠°≠"
CALL LoadData("POEM.TXT")

CALL MainPage

TX ("KB1,1M3CU1,1")
LOCATE 1,1
PRINT "–ª–ªπ€…Õ"
CLOSE
END

FUNCTION n$ (A AS INTEGER)
n$ = LTRIM$(RTRIM$(STR$(A)))
END FUNCTION

SUB InitTX
    DIM A%(50)
    DEF SEG = VARSEG(A%(0))
    RESTORE
    FOR I% = 0 TO 41
        READ D%
        IF I% = 4 THEN
        D% = VARPTR(A%(49)) MOD 256
        ELSEIF I% = 5 THEN
        D% = VARPTR(A%(49)) / 256
        END IF
        POKE VARPTR(A%(0)) + I%, D%
    NEXT I%
    CALL ABSOLUTE(VARPTR(A%(0)))
    DEF SEG
    IF A%(49) = 0 THEN
        PRINT "Please run TX.COM first"
    END
    END IF
    OPEN "LPT3" FOR OUTPUT AS #1
END SUB

SUB TX (s AS STRING)
    PRINT #1, CHR$(14); "["; s; "]";
END SUB

SUB LoadData(FILENAME AS STRING)
    OPEN FILENAME FOR INPUT AS #2
    SHARED TITLELEN,CONTENTLEN
    DO
        LINE INPUT #2,DATATEXT$
        SELECT CASE DATATEXT$
            CASE ".TITLE"
                TITLELEN=TITLELEN+1
                LINE INPUT #2,DATATEXT$
                TITLELIST(TITLELEN-1).TITLE=DATATEXT$
            CASE ".AUTHOR"
                LINE INPUT #2,DATATEXT$
                TITLELIST(TITLELEN-1).AUTHOR=DATATEXT$
            CASE ".CMD"
                LINE INPUT #2,DATATEXT$
                CONTENTLIST(CONTENTLEN).ID=TITLELEN-1
                CONTENTLIST(CONTENTLEN).OPER=0
                CONTENTLIST(CONTENTLEN).TEXT=DATATEXT$
                CONTENTLEN=CONTENTLEN+1
            CASE ".TEXT"
                LINE INPUT #2,DATATEXT$
                CONTENTLIST(CONTENTLEN).ID=TITLELEN-1
                CONTENTLIST(CONTENTLEN).OPER=1
                CONTENTLIST(CONTENTLEN).TEXT=DATATEXT$
                CONTENTLEN=CONTENTLEN+1
        END SELECT
    LOOP UNTIL (EOF(2))
    CLOSE #2
END SUB

SUB MainPage
    REM TX ("M18CU1,0KB1,0CL0CO7B0,0,640,480")
    FOR I=0 TO TITLELEN-1 STEP 1
        PRINT RTRIM$(TITLELIST(I).TITLE);" - ";RTRIM$(TITLELIST(I).AUTHOR)
    NEXT I
    WHILE 1:
        SELECT CASE INKEY$
            CASE "1"
                DisplayPoem(0)
            CASE "q"
                EXIT SUB
        END SELECT
    WEND
END SUB

SUB DisplayPoem(ID as INTEGER)
    STATIC ITEM AS ContentT
    FOR I=0 TO CONTENTLEN-1 STEP 1
        ITEM=CONTENTLIST(I)
        IF ITEM.ID=ID THEN
            PRINT ITEM.TEXT
        END IF
    NEXT I
    WHILE INKEY$="": WEND
END SUB