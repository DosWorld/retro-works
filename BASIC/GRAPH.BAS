DECLARE FUNCTION nd$ (A#)
DECLARE FUNCTION percent$ (A#)

DEFINT A-Z: DEFDBL P
COMMON PI
DECLARE SUB DRAWPIE(X AS INTEGER, Y AS INTEGER, R AS INTEGER, S AS DOUBLE, E AS DOUBLE, CL AS INTEGER)
PI=3.141592654

DIM LABEL$(2048),VALUE#(2048)

L=0:LT=0:S#=0:M#=0:Y=1
INPUT "Filename: ", F$
OPEN F$ FOR INPUT AS #1
WHILE NOT EOF(1)
  INPUT #1,T$,D#: L=L+1
  S#=S#+D#: IF D#>M# THEN M#=D#
  K=LEN(T$)+LEN(percent$(D#/M#))+3: IF K>LT THEN LT=K
  LABEL$(L)=T$:VALUE#(L)=D#
WEND
CLOSE #1

SCREEN 12:WIDTH 80,60:COLOR 15:CLS
LT=LT*8:W=638-LT

FOR I=1 TO L
  T$=LABEL$(I):D#=VALUE#(I)
  LOCATE Y,1,0:PRINT T$;" (";percent$(D#/S#);")";
  K!=D#/M#:LINE (LT+1,(Y-1)*8)-(K!*W+LT+1,(Y-1)*8+6),,BF
  IF (I MOD 59)<>0 OR I=L THEN
    Y=Y+1
  ELSE
    LOCATE 60,1,0:PRINT "Press any key to continue";TAB(79);
    WHILE INPUT$(1)="":WEND:CLS:Y=1
  END IF
NEXT I
WHILE INPUT$(1)="":WEND:CLS
IF L>60 THEN SCREEN 0:END

Y=(60-L)/2: K1#=0: K2#=VALUE#(1)
FOR I=1 TO L
  T$=LABEL$(I):D#=VALUE#(I)
  IF I = L THEN
    COL = 1
    CALL DRAWPIE(430, 240, 200, FIX(K1#/S#*360), 360, 1)
  ELSE
    COL = ((I-1) mod 13)+2
    CALL DRAWPIE(430, 240, 200, FIX(K1#/S#*360), FIX(K2#/S#*360), COL)
    K1#=K1#+VALUE#(I):K2#=K2#+VALUE#(I+1)
  END IF
  LOCATE Y+1,3,0:PRINT T$+" ("+percent$(D#/S#)+")";
  LINE (0,Y*8)-(6,Y*8+6),COL,BF
  Y=Y+1
NEXT I
WHILE INPUT$(1)="":WEND:CLS:SCREEN 0:END

SUB DRAWPIE(X AS INTEGER, Y AS INTEGER, R AS INTEGER, S AS DOUBLE, E AS DOUBLE, CL AS INTEGER)
  SHARED PI
  IF (E-S)<1 THEN EXIT SUB
  IF S=0 THEN S=0.00001
  CIRCLE (X,Y),R,CL,-(S/180*PI),-(E/180*PI),1
  XP = X+(R-10)*COS((S+(E-S)/2)/180*PI)
  YP = Y-(R-10)*SIN((S+(E-S)/2)/180*PI)
  PAINT (XP,YP),CL
END SUB

FUNCTION nd$ (A AS DOUBLE)
  nd$ = LTRIM$(RTRIM$(STR$(A)))
END FUNCTION

FUNCTION percent$(A AS DOUBLE)
  p# = FIX(A * 100000 + 0.5) / 1000
  pn$ = nd$(p#):if p#<1 and p#>0 then pn$ = "0"+pn$
  percent$ = mid$(pn$, 1, len(str$(fix(p#)))+3) + "%"
END FUNCTION
