DECLARE FUNCTION nd$ (A#)
DECLARE FUNCTION percent$ (A#)

DEFINT A-Z: DEFDBL P
COMMON PI
DECLARE SUB DRAWPIE(X AS INTEGER, Y AS INTEGER, R AS INTEGER, S AS DOUBLE, E AS DOUBLE, CL AS INTEGER)
PI=3.141592654

L=0:LT=0:S#=0:M#=0:Y=1

INPUT "Filename: ", F$
OPEN F$ FOR INPUT AS #1
WHILE NOT EOF(1)
  INPUT #1,T$,D#: L=L+1
  S#=S#+D#: IF D#>M# THEN M#=D#
  K=LEN(T$): IF K>LT THEN LT=K
WEND
CLOSE #1

SCREEN 12
WIDTH 80,60
COLOR 15
CLS:DIM G(2048)
LT=LT*8:W=638-LT

OPEN F$ FOR INPUT AS #1
FOR I=1 TO L
  INPUT #1,T$,D#

  LOCATE 60,1,0:PRINT T$;TAB(79);
  GET (0,472)-(LT,479),G:PUT (0,Y),G,PSET

  K!=D#/M#:LINE (LT+1,Y-1)-(K!*W+LT+1,Y+7),,BF

  LOCATE 60,1,0
  SV$ = LTRIM$(RTRIM$(STR$(D#))) + " (" + percent$(D#/S#) + ")"
  PRINT SV$;TAB(79);
  GET (0,472)-(LEN(SV$)*8,479),G
  IF K!>0.5 THEN
    PUT (K!*W+LT-LEN(SV$)*8,Y),G,PRESET
  ELSE
    PUT (K!*W+LT+8,Y),G,PSET
  END IF
  IF (I MOD 47)<>0 OR I=L THEN
    Y=Y+10
  ELSE
    LOCATE 60,1,0:PRINT "Press any key to continue";TAB(79);
    WHILE INPUT$(1)="":WEND:CLS:Y=1
  END IF
NEXT I
CLOSE #1
LOCATE 60,1,0:PRINT TAB(79);
WHILE INPUT$(1)="":WEND:CLS
IF L>47 THEN SCREEN 0:END

OPEN F$ FOR INPUT AS #1
SANGLE# = 0: 
FOR I=1 TO L
  INPUT #1,T$,D#
  IF I = L THEN
    COL = 1
    CALL DRAWPIE(430, 240, 200, SANGLE#, 360, 1)
  ELSE
    COL = (I mod 14)+1 : ANGLE# = SANGLE#+FIX(D#/S#*360)
    CALL DRAWPIE(430, 240, 200, SANGLE#, ANGLE#, COL)
    SANGLE#=ANGLE#
  END IF
NEXT I
CLOSE #1

OPEN F$ FOR INPUT AS #1
Y=(480-10*L)/2
FOR I=1 TO L
  INPUT #1,T$,D#
  IF I = L THEN
    COL = 1
  ELSE
    COL = (I mod 14)+1
  END IF
  LOCATE 60,1,0
  SV$=T$+" ("+percent$(D#/S#)+")"
  PRINT SV$;TAB(79);
  GET (0,472)-(LEN(SV$)*8,479),G
  LOCATE 60,1,0:PRINT TAB(79);
  PUT (16,Y+1),G,PSET
  LINE (4,Y)-(12,Y+8),COL,BF
  Y=Y+10
NEXT I
CLOSE #1
WHILE INPUT$(1)="":WEND:CLS:SCREEN 0:END

SUB DRAWPIE(X AS INTEGER, Y AS INTEGER, R AS INTEGER, S AS DOUBLE, E AS DOUBLE, CL AS INTEGER)
  SHARED PI
  IF (E-S)<1 THEN EXIT SUB
  IF S=0 THEN S=0.00001
  CIRCLE (X,Y),R,CL,-(S/180*PI),-(E/180*PI),1
  XP = X+(R-10)*COS((S+(E-S)/2)/180*PI)
  YP = Y-(R-10)*SIN((S+(E-S)/2)/180*PI)
  PAINT (XP,YP),CL
END SUB

FUNCTION nd$ (A AS DOUBLE)
  nd$ = LTRIM$(RTRIM$(STR$(A)))
END FUNCTION

FUNCTION percent$(A AS DOUBLE)
  percent$ = nd$(FIX(A * 100)) + "." + nd$(FIX(A * 100000) MOD 1000) + "%"
END FUNCTION
