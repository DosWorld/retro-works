-----
title: 论软件设计模式及其应用
tags: [软考,系统架构设计师]
-----

【摘要】
-------

　　本人所在公司接到了为客户开发BI系统的任务，该系统主要根据后台存储的数据生成图表展示页面，供客户方高管查看、并在客户方的大屏幕上展示，且客户方相关工作人员可以编辑图表展示页面的布局和页面中要显示的卡片。本人主要负责领导前端团队进行开发工作，并设计BI系统的前端架构，以及与后端团队的沟通。
　　本文讨论了项目中用到的设计模式及其适用场景，以及各个设计模式在该项目中的具体用法。通过在不同的需求场景下对设计模式的合理运用，使得系统的整体架构易于理解，提高了系统的可用性和可维护性；同时通过适配器模式的使用成功地实现了图表卡片开发任务和测试任务的并行化，充分利用了前端开发团队和测试团队的人力，缩短了开发周期，减少了开发成本，提高了产品质量。是综合应用各种设计模式设计系统架构的成功实践。

【正文】
-------

　　本人所在公司接到了为客户开发BI系统的任务，该系统主要根据后台存储的数据生成图表展示页面，供客户方高管查看、并在客户方的大屏幕上展示，且客户方相关工作人员可以编辑图表展示页面的布局和页面中要显示的卡片。系统采用前后端分离架构，后端主要使用的技术有JAVA、SpringBoot、PostgreSQL，前端主要使用的技术有Vue.js、vuex、ECharts、Element-UI。
　　系统主要分为三部分：一、卡片模块：用来显示不同类型的图表，包括柱状图、条形图、散点图、杜邦图等，每一张卡片都对应了不同的数据源、数据类型、图表类型等内容。二、页面编辑模块：可以通过拖动的方式编辑图表展示页面的布局，然后再为布局中的每个格子配置待显示的卡片，最后再配置该页面对应的菜单项。三、页面展示模块：包括菜单和图表页面显示区，根据用户点击的菜单项，拉取对应的页面布局信息生成对应的页面，然后再拉取页面中的卡片数据并将卡片显示在页面的相应位置中。
　　本人主要负责领导前端团队进行开发工作，并设计BI系统的前端架构，以及与后端团队的沟通。
　　在进行需求分析时，本人发现所要开发的页面结构复杂，图表数量多且种类多，并且页面中存在大量联动操作需要处理。为了方便任务的并行化，减轻团队开发的压力，增强页面的可维护性和稳定性，需要对页面进行模块划分，且在此过程中需要应用多种设计模式进行架构设计。
　　设计模式分为创建型设计模式、结构型模式、行为型模式三大类，创建型模式主要用于对象的创建操作，结构型模式主要用于静态地表示各个类/对象之间的关系，行为型模式主要用于处理对象间的通信操作。其中创建型模式有以下模式：单例模式、工厂模式、抽象工厂模式、建造者模式、原型模式；结构型模式有以下模式：组合模式、过滤器模式、桥接模式、适配器模式、过滤器模式、外观模式、装饰器模式；行为型模式包含以下模式：责任链模式、解释器模式、命令模式、迭代器模式、中介者模式、观察者模式、状态模式、策略模式、备忘录模式。
　　创建型模式中的单例模式用于处理一个公共对象在系统的整个生命周期中只创建一次，且被多个构件使用的场景。
　　创建型模式中的工厂模式通常用于根据给定的条件创建出不同的实例，也可用于内部结构复杂的对象的创建，比如根据数据库里的数据创建树形结构的数据。
　　结构型模式的组合模式用于表示各个组件的层级结构，也可用于将关系复杂的子组件包装成单个组件，以增加系统的可修改性。
　　结构型模式中的适配器模式可用于处理当构件无法直接在系统中使用，需要做适配才能使用的场景，比如一个图表组件需要做适配才能符合系统要求并达到相应显示效果。
　　行为型模式中的命令模式和备忘录通常用于处理需要支持撤销、恢复操作的场景，比如本系统中的界面布局编辑器。
　　在开发页面展示模块的菜单模块时，菜单数据是从后台直接读取的，每行仅包含当前菜单项的ID、当前菜单项的父ID、当前菜单项的名称，无法直接在页面上使用，且后端开发团队人手不足无法开发相应的转换操作模块，此时本人决定使用建造者模式，将菜单数据转换成树形结构以便显示在页面上，并确定哪些是末级菜单、哪些是非末级菜单，同时使用迭代器模式处理将菜单项显示在页面上的过程。又因为页面上需要根据用户点击的菜单项显示不同的页面，本人决定使用观察者模式来处理以下动作：当用户点击的菜单项后，发出菜单项ID变更事件，图表页面显示区监听到此事件后进行新页面加载操作。
　　页面显示区需要根据所获取的布局数据和图表数据按照对应的布局显示相应的页面，本人使用了结构型模式中的组合模式，根据获取的数据，先用页面布局组件在页面上安排好布局，然后再在布局中的空格中显示对应的图表卡片，使得页面中各个组件的结构和关联关系更加清晰易于理解。图表卡片则使用适配器模式，以便将团队其它成员开发的图表作为图表卡片集成到页面显示区中。
　　页面布局编辑模块需要支持撤销、重做的操作，本人决定使用行为型模式中的命令模式和备忘录模式，把每个编辑页面产生的结果写入公共的数据中心中，且每个编辑操作及其对应的操作前的状态、操作后的状态均被记录下来以供撤销、重做功能使用。
　　通过在不同的需求场景下对设计模式的合理运用，使得系统的整体架构易于理解，提高了系统的可用性和可维护性；同时通过适配器模式的使用成功地实现了图表卡片开发任务和测试任务的并行化，充分利用了前端开发团队和测试团队的人力，缩短了开发周期，减少了开发成本，提高了产品质量。虽然在开发过程中需求经常发生变化，但大部分集中在图表卡片中，没有涉及到整体架构，因此所需改动被控制在较小范围，开发成本和测试成本的增加亦可控。最终项目产品得以在规定时间内交付客户，赢得了客户的好评，为日后对产品的改进赢得了空间。
　　在页面显示模块中，存在着每张图表卡片需要调用一次后台接口的问题，因后台人手不足暂未实现，在单个页面内图表数量较多时会因为HTTP请求数过多，出现加载速度变慢的问题。后期计划使用结构设计模式中的享元模式以及创建设计模式中的单例模式，添加一个图表卡片数据加载器作为单例，将在加载的时候先收集页面上所有需要加载图表卡片的ID，然后将收集的ID集中通过数据加载器发送单次HTTP请求获取图表卡片数据。
　　总之，本项目是综合应用各种设计模式设计系统架构的成功实践。
